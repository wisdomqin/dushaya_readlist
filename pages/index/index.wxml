<safe-area-top></safe-area-top>
<view class="page-container" style="{{containerStyle}}">
  <scroll-view 
    scroll-y="true" 
    class="book-list-container" 
    bindscrolltolower="loadMore"
    refresher-enabled="{{true}}"
    refresher-threshold="{{100}}"
    refresher-default-style="none"
    refresher-background="#f5f5f5"
    refresher-triggered="{{isRefreshing}}"
    bindrefresherrefresh="onPullDownRefresh"
  >
    <view slot="refresher" class="refresher-container">
      <view class="refresher-content">
        <text class="refresher-text">大家多多贡献，读啥鸭也会隔几十分钟自动更新书单~</text>
      </view>
    </view>
    <view wx:if="{{bookLists.length === 0}}" class="no-data">
      <text>暂无书单，快去添加吧！</text>
    </view>
    <view wx:for="{{bookLists}}" wx:key="_id" class="book-card" bindtap="goToDetail" data-id="{{item._id}}">
      <view class="duck-review">
        <text class="review-content">"{{item.review}}"</text>
        <text class="review-title">——读啥鸭评价</text>
      </view>
      <view class="book-info">
        <view class="book-title-grade">
          <text class="book-title">{{item.title}}</text>
          <view class="book-grade-container">
            <view class="grade-image-container">
              <image class="grade-image" src="{{gradeImages[item.grade] || gradeImages['default']}}" mode="aspectFit"></image>
            </view>
            <view class="book-grade">{{item.grade || '无评级'}}</view>
          </view>
        </view>
        <text class="book-author">作者：{{item.author}}</text>
        <view class="book-tags">标签：{{item.tags}}</view>
        <text class="book-description">简介：{{item.description}}</text>
      </view>
      <view class="book-rating" wx:if="{{item.rating > 0}}">
        <text class="rating-score">{{item.rating}}</text>
        <text class="rating-count" wx:if="{{item.ratingCount > 0}}">{{item.ratingCount}}人评分</text>
      </view>
    </view>
  </scroll-view>
  <view class="bottom-container">
    <view class="tag-container">
      <view 
        wx:for="{{randomTags}}" 
        wx:key="*this" 
        class="tag-btn {{selectedTag === item ? 'selected' : ''}}"
        bindtap="onTagTap"
        data-tag="{{item}}"
      >
        {{item}}
      </view>
    </view>
    <view class="search-btn" bindtap="goToSearch">搜索</view>
  </view>
  <view class="submit-btn" bindtap="goToSubmit">+</view>
</view>
